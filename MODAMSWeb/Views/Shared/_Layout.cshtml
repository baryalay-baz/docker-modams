@using System.Globalization
@using System.Text.Json
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery

<!DOCTYPE html>
<html lang="en">
<head>
    @{
        var tokens = Antiforgery.GetAndStoreTokens(ViewContext.HttpContext);
        var bridge = new
        {
            culture = CultureInfo.CurrentUICulture.Name,
            cultureTwoLetter = CultureInfo.CurrentUICulture.TwoLetterISOLanguageName,
            user = new
            {
                name = User?.Identity?.Name ?? "",
                isAuthenticated = User?.Identity?.IsAuthenticated ?? false
            },
            basePath = Url.Content("~/"),
            antiForgery = new
            {
                headerName = tokens.HeaderName,
                requestToken = tokens.RequestToken
            },
            nowUtc = DateTime.UtcNow
        };
    }
    <script>
        window.AMS = window.AMS || {};
        window.AMS.bridge = @Html.Raw(JsonSerializer.Serialize(bridge));
    </script>
    <!-- Driver.js + Tutor (keep if most pages need it; otherwise lazy-load on click) -->
    <script src="https://cdn.jsdelivr.net/npm/driver.js@latest/dist/driver.js.iife.js"></script>

    <meta name="request-verification-token" content="@tokens.RequestToken" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="~/assets/images/brand/favicon.ico" />

    <title>MOD Asset Management System</title>

    <!-- Driver.js CSS (kept light; actual JS is loaded below or per-page if you prefer) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/driver.js@latest/dist/driver.css" />


    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Datatables css start here-->
    

    <!-- Theme CSS -->
    <link href="~/assets/css/style.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/assets/css/skin-modes.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/assets/css/icons.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/css/custom_css_layout.css" rel="stylesheet" />
    <link href="~/css/popover.css" rel="stylesheet" />

    <!-- FontAwesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Kendo UI (keep here only if most pages use Kendo; otherwise move to a partial like others) -->
    <link href="https://kendo.cdn.telerik.com/themes/7.0.2/bootstrap/bootstrap-main.css" rel="stylesheet" />

    <!-- Select2 CSS (same rule: move to partial if used rarely) -->
    <link href="~/assets/plugins/select2/css/select2.css" rel="stylesheet" asp-append-version="true" />

    <!-- Tutor styles -->
    <link rel="stylesheet" href="~/css/pams-tutor.css" />
</head>

<body data-page="@((ViewData["TourPageKey"] ?? "").ToString())"
      data-page-fallback="@($"{ViewContext.RouteData.Values["Controller"]}/{ViewContext.RouteData.Values["Action"]}")">

    <!-- GLOBAL-LOADER -->
    <div id="global-loader">
        <img src="~/assets/images/loader.svg" class="loader-img" alt="Loader">
    </div>

    <div class="app sidebar-mini page">
        <div class="page-main">
            <partial name="layouts/_app-header.cshtml" />
            <partial name="layouts/_app-sidebar.cshtml" />

            <div class="app-content main-content mt-0">
                <div class="side-app">
                    <div class="main-container container-fluid">
                        <div class="js-notification"></div>
                        @RenderBody()
                    </div>
                </div>
            </div>
        </div>
        <partial name="layouts/-selector-model.cshtml" />
        <partial name="layouts/_footer.cshtml" />
    </div>

    <button id="PamsHelpFab" class="pams-help-fab" title="Tutor">
        <i class="bi bi-mortarboard-fill"></i>
    </button>

    <!-- Core JS -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap bundle includes Popper (so we do NOT load Popper separately) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Keep your core app scripts -->
    <script src="~/js/utils.js"></script>
    <script src="~/js/core/page-registry.js"></script>


    <script src="~/js/tours-loader.js" asp-append-version="true"></script>
    <script src="~/js/tutor/pams-tutor-core.js" asp-append-version="true"></script>
    
    <script src="~/assets/plugins/sidemenu/sidemenu.js"></script>

    <!-- Optional libs (KEEP ONLY IF used on most pages; otherwise move them to per-page partials) -->
    <!-- Select2 -->
    <script src="~/assets/plugins/select2/select2.full.min.js"></script>
    <!-- Kendo (move out if not widely used) -->
    <script src="https://cdn.kendostatic.com/2023.2.606/js/jszip.min.js"></script>
    <script src="https://cdn.kendostatic.com/2023.2.606/js/kendo.all.min.js"></script>
    <script src="https://cdn.kendostatic.com/2023.2.606/js/kendo.aspnetmvc.min.js"></script>

    
    <script src="~/assets/plugins/notify/js/rainbow.js"></script>
    <script src="~/assets/plugins/notify/js/jquery.growl.js"></script>
    <script src="~/assets/plugins/notify/js/notifIt.js"></script>
    <script src="~/assets/plugins/p-scroll/perfect-scrollbar.js"></script>
    <script src="~/assets/js/form-validation.js"></script>
    <script src="~/assets/js/sticky.js"></script>
    <script src="~/assets/js/themeColors.js"></script>
    <script src="~/assets/js/custom.js"></script>

    <script src="~/js/kendo-ui-license.js"></script>
    <script src="~/assets/plugins/moment/moment.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>

    
    

    <!-- Page layout glue -->
    <script src="~/js/pages/layout.js" asp-append-version="true"></script>
    <partial name="_ValidationScriptsPartial" />
    <partial name="_Notification" />

    <!-- Per-page script sections -->
    @if (IsSectionDefined("scripts"))
    {
        @await RenderSectionAsync("scripts", required: false)
    }
    else if (IsSectionDefined("Scripts"))
    {
        @await RenderSectionAsync("Scripts", required: false)
    }

    
</body>
</html>
