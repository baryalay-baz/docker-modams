@using System.Globalization
@using System.Text.Json
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery

<!DOCTYPE html>
<html lang="en">
<head>
    
    @{
        var tokens = Antiforgery.GetAndStoreTokens(ViewContext.HttpContext);
        var bridge = new
        {
            culture = CultureInfo.CurrentUICulture.Name, // e.g., "so-SO" or "en-US"
            cultureTwoLetter = CultureInfo.CurrentUICulture.TwoLetterISOLanguageName, // "so" | "en"
            user = new
            {
                name = User?.Identity?.Name ?? "",
                isAuthenticated = User?.Identity?.IsAuthenticated ?? false
            },
            basePath = Url.Content("~/"),
            antiForgery = new
            {
                headerName = tokens.HeaderName,
                requestToken = tokens.RequestToken
            },
            nowUtc = DateTime.UtcNow
        };
    }
    
    <script>
        window.PAMS = window.PAMS || {};
        // One canonical bridge object, JSON-serialized server-side (prevents XSS string concat bugs)
        window.PAMS.bridge = @Html.Raw(JsonSerializer.Serialize(bridge));
        
    </script>

    <meta name="request-verification-token" content="@tokens.RequestToken" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Charts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.min.js"></script>
    <script src="~/assets/plugins/chart/chartjs-plugin-labels.js"></script>

    <!-- FAVICON -->
    <link rel="shortcut icon" type="image/x-icon" href="~/assets/images/brand/favicon.ico" />

    <title>MOD Asset Management System</title>

    <!-- Driver.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/driver.js@latest/dist/driver.css" />

    <style>
        /* Floating Help button */
        .pams-help-fab {
            position: fixed;
            right: 18px;
            bottom: 18px;
            z-index: 9999;
            background: #0d6efd;
            color: #fff;
            border: none;
            border-radius: 999px;
            width: 48px;
            height: 48px;
            font-size: 22px;
            line-height: 48px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,.15);
            cursor: pointer;
            display: inline-block;
            vertical-align:middle;
        }

            .pams-help-fab:hover {
                filter: brightness(0.95);
            }
    </style>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Bootstrap Datepicker CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/css/bootstrap-datepicker.min.css" rel="stylesheet">

    <!-- SELECT2 -->
    <link href="~/assets/plugins/select2/css/select2.css" rel="stylesheet" asp-append-version="true" />

    <!-- Theme CSS -->
    <link href="~/assets/css/style.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/assets/css/skin-modes.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/assets/css/icons.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/css/custom_css_layout.css" rel="stylesheet" />
    <link href="~/css/popover.css" rel="stylesheet" />

    <!-- Add FontAwesome in <head> if not added -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />


    <!-- Kendo UI -->
    <link href="https://kendo.cdn.telerik.com/themes/7.0.2/bootstrap/bootstrap-main.css" rel="stylesheet" />
  
    
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.kendostatic.com/2023.2.606/js/jszip.min.js"></script>
    <script src="https://cdn.kendostatic.com/2023.2.606/js/kendo.all.min.js"></script>
    <script src="https://cdn.kendostatic.com/2023.2.606/js/kendo.aspnetmvc.min.js"></script>

    <script src="~/js/utils.js"></script>
    <link rel="stylesheet" href="~/css/pams-tutor.css" />
</head>

<body class="app sidebar-mini ltr" data-page="@((ViewData["TourPageKey"] ?? "").ToString())">

    <!-- GLOBAL-LOADER -->
    <div id="global-loader">
        <img src="~/assets/images/loader.svg" class="loader-img" alt="Loader">
    </div>

    <div class="page">
        <div class="page-main">
            <partial name="layouts/_app-header.cshtml" />
            <partial name="layouts/_app-sidebar.cshtml" />

            <div class="app-content main-content mt-0">
                <div class="side-app">
                    <div class="main-container container-fluid">
                        <div class="js-notification"></div>
                        @RenderBody()
                    </div>
                </div>
            </div>
        </div>
        <partial name="layouts/-selector-model.cshtml" />
        <partial name="layouts/_footer.cshtml" />
    </div>

    <button id="PamsHelpFab" class="pams-help-fab" title="Tutor">
        <i class="bi bi-mortarboard-fill"></i>
    </button>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="~/assets/plugins/sidemenu/sidemenu.js"></script>
    <script src="~/assets/plugins/notify/js/rainbow.js"></script>
    <script src="~/assets/plugins/notify/js/jquery.growl.js"></script>
    <script src="~/assets/plugins/notify/js/notifIt.js"></script>
    <script src="~/assets/plugins/select2/select2.full.min.js"></script>

    <!-- Datatables -->
    <script src="~/assets/plugins/datatable/js/jquery.dataTables.min.js"></script>
    <script src="~/assets/plugins/datatable/js/dataTables.bootstrap5.js"></script>
    <script src="~/assets/plugins/datatable/js/dataTables.buttons.min.js"></script>
    <script src="~/assets/plugins/datatable/js/buttons.bootstrap5.min.js"></script>
    <script src="~/assets/plugins/datatable/pdfmake/pdfmake.min.js"></script>
    <script src="~/assets/plugins/datatable/pdfmake/vfs_fonts.js"></script>
    <script src="~/assets/plugins/datatable/js/buttons.html5.min.js"></script>
    <script src="~/assets/plugins/datatable/js/buttons.print.min.js"></script>
    <script src="~/assets/plugins/datatable/js/buttons.colVis.min.js"></script>
    <script src="~/assets/plugins/datatable/dataTables.responsive.min.js"></script>
    <script src="~/assets/plugins/datatable/responsive.bootstrap5.min.js"></script>

    <script src="~/assets/plugins/p-scroll/perfect-scrollbar.js"></script>
    <script src="~/assets/js/form-validation.js"></script>
    <script src="~/assets/js/sticky.js"></script>
    <script src="~/assets/js/themeColors.js"></script>
    <script src="~/assets/js/custom.js"></script>
    <script src="~/js/kendo-ui-license.js"></script>
    <script src="~/assets/plugins/moment/moment.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.8/umd/popper.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Driver.js + Registry -->
    <script src="https://cdn.jsdelivr.net/npm/driver.js@latest/dist/driver.js.iife.js"></script>
    
    <!-- PAMS Tours -->
    <script src="~/js/tours-loader.js" asp-append-version="true"></script>
    @* <script src="~/js/tours/pams-tutor.js"></script> *@
    <script src="~/js/tutor/pams-tutor-core.js" asp-append-version="true"></script>
    <script src="~/js/layout.js" asp-append-version="true"></script>

    <partial name="_ValidationScriptsPartial" />
    <partial name="_Notification" />

    @if (IsSectionDefined("scripts"))
    {
        @await RenderSectionAsync("scripts", required: false)
    }
    else if (IsSectionDefined("Scripts"))
    {
        @await RenderSectionAsync("Scripts", required: false)
    }
    
    

</body>
</html>
