@using System.Globalization
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

@{
    var currentCulture = CultureInfo.CurrentUICulture.Name; // "en" or "so"
}

<style>
    /* Existing styles */
    #dvNotifications {
        width: 500px;
    }

    .profile-user {
        max-width: 100%;
        max-height: 100%;
        object-fit: cover;
    }

    .notifyimg {
        width: 50px;
        height: 50px;
    }

    .notification-each {
        align-items: center;
    }

    .btn-no-bg {
        background-color: transparent;
        border: none;
        box-shadow: none;
        padding: 0;
    }

        .btn-no-bg:focus,
        .btn-no-bg:hover {
            background-color: transparent;
            border: none;
            box-shadow: none;
        }

    .language {
        width: 20px;
        height: 14px;
        object-fit: cover;
        margin-right: 6px;
    }

    /* New: make header icons match sidebar sizing/colors */
    .header-icon,
    .source-logo-container i,
    .nav-link.icon i,
    .shortcut-icn i,
    .full-screen-link i {
        font-size: 18px;
        width: 20px;
        min-width: 20px;
        text-align: center;
        color: #4c5372;
        line-height: 1;
    }

    .nav-link.icon:hover i,
    .source-logo-container:hover i,
    .shortcut-icn:hover i,
    .full-screen-link:hover i {
        color: #0d6efd;
    }

    /* Shortcut cards alignment */
    .source-logo-container {
        display: flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
    }

    .source-logo-menu .row > .col {
        display: flex;
    }

    .source-logo-menu .dropdown-menu-item span {
        display: inline-block;
    }

    /* --- Shortcuts dropdown fix --- */
    .source-logo-menu .px-2 {
        padding-left: 12px !important;
        padding-right: 12px !important;
    }

    /* Turn each row into a tidy grid (works even with the existing .row/.col markup) */
    .source-logo-menu .row {
        display: grid;
        grid-template-columns: repeat(3, minmax(160px, 1fr)); /* change 3 -> 2 if you want two columns */
        gap: 10px 16px;
        margin: 0 !important;
    }

    /* Make each link a clean, aligned pill */
    .source-logo-container.dropdown-menu-item {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        width: 100%;
        padding: 6px 8px;
        border-radius: 8px;
        text-decoration: none;
        /* override any random text-muted sprinkled in HTML */
        color: #4c5372 !important;
    }

    /* Icon normalization (Feather + FA) */
    .source-logo-container i {
        font-size: 18px;
        width: 20px;
        min-width: 20px;
        text-align: center;
        line-height: 1; /* fix baseline wobble */
        vertical-align: middle; /* keeps FA + Fe aligned */
    }

    /* Label inherits link color */
    .source-logo-container span {
        color: inherit;
    }

    /* Hover/active */
    .source-logo-container:hover {
        background: rgba(13, 110, 253, 0.08);
        color: #0d6efd !important;
    }

        .source-logo-container:hover i {
            color: #0d6efd;
        }

    /* More breathing room between items (row gap) */
    .source-logo-menu .row {
        /* row-gap | column-gap */
        gap: 22px 16px; /* was 10px 16px */
    }

        /* Extra space between the three grid sections */
        .source-logo-menu .row + .row {
            margin-top: 12px !important; /* nudge this up/down as you like */
        }

    /* Optional: slightly bigger tappable area per item */
    .source-logo-container.dropdown-menu-item {
        padding: 8px 10px; /* was 6px 8px */
    }

    /* default */
    .nav-link[aria-label="Alerts"] i {
        color: #4c5372;
    }
    /* has alerts */
    #hasCriticalAlerts .nav-link[aria-label="Alerts"] i {
        color: #dc3545;
    }
    /* danger */
    #hasWarnings .nav-link[aria-label="Alerts"] i {
        color: #fd7e14;
    }
    /* warning */

    /* Notifications list spacing */
    #dvNotifications {
        max-height: 420px; /* keep dropdown scrollable */
        overflow: auto;
        padding: 6px 0; /* breathing room top/bottom */
    }

        /* If your rows use this class (you mentioned it earlier) */
        #dvNotifications .notification-each {
            display: flex;
            align-items: center;
            gap: 10px; /* space between icon/text */
            padding: 10px 12px; /* vertical spacing per row */
            border-bottom: 1px solid #eef2f6;
        }

            #dvNotifications .notification-each:last-child {
                border-bottom: none;
            }

            /* Tighter text rhythm without cramping */
            #dvNotifications .notification-each p,
            #dvNotifications .notification-each .title,
            #dvNotifications .notification-each .meta {
                margin: 0;
                line-height: 1.3;
            }

        /* Icon/avatar normalization (optional) */
        #dvNotifications .notifyimg {
            width: 42px;
            height: 42px;
            border-radius: 8px; /* looks neat for thumbs */
            object-fit: cover;
        }

        /* Fallback: if rows don't have .notification-each,
       add spacing between ANY consecutive children */
        #dvNotifications > * + * {
            margin-top: 10px; /* vertical gap between rows */
        }



    /* Optional: make the grid switch to 2 columns on narrow dropdowns */
    @@media (max-width: 480px) {
        .source-logo-menu .row

    {
        grid-template-columns: repeat(2, minmax(150px, 1fr));
    }

    }
</style>

<!-- app-Header -->
<div class="app-header header sticky">
    <div class="container-fluid main-container">
        <div class="d-flex">
            <a id="hideMenu" aria-label="Hide Sidebar" class="app-sidebar__toggle" data-bs-toggle="sidebar" href="#" data-tour="header.sidebar-toggle"></a>
            <!-- sidebar-toggle-->
            <!-- LOGO -->
            <img src="~/assets/images/brand/FGS_Small4.png" />

            <!-- Global Search -->
            <div class="main-header-center ms-3 d-none d-xl-block">
                <input class="form-control" id="txtGlobalSearch" placeholder="@Localizer["ScanBarcode"]" type="search" data-tour="header.search" />
                <button class="btn" id="btnGlobalSearch" data-tour="header.search-btn" aria-label="Search">
                    <i class="fe fe-search header-icon"></i>
                </button>
            </div>

            <div class="d-flex order-lg-2 ms-auto header-right-icons">
                <!-- Mobile search -->
                <div class="dropdown d-xl-none d-md-block d-none">
                    <a href="#" class="nav-link icon" data-bs-toggle="dropdown">
                        <i class="fe fe-search header-icon"></i>
                    </a>
                    <div class="dropdown-menu header-search dropdown-menu-start">
                        <div class="input-group w-100 p-2">
                            <input type="text" class="form-control" placeholder="@Localizer["ScanBarcode"]">
                            <div class="input-group-text btn btn-primary">
                                <i class="fe fe-search"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navbar toggler -->
                <button class="navbar-toggler navresponsive-toggler d-md-none ms-auto" type="button"
                        data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent-4"
                        aria-controls="navbarSupportedContent-4" aria-expanded="false"
                        aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon fe fe-more-vertical"></span>
                </button>

                <div class="navbar navbar-collapse responsive-navbar p-0">
                    <div class="collapse navbar-collapse" id="navbarSupportedContent-4">
                        <div class="d-flex order-lg-2">
                            <!-- Language -->
                            <div class="dropdown">
                                <button class="btn btn-no-bg dropdown-toggle" type="button" id="languageDropdown"
                                        data-bs-toggle="dropdown" aria-expanded="false" data-tour="header.language">
                                    @if (currentCulture == "so")
                                    {
                                        <img class="language" src="/assets/images/flags/so.svg" alt="Somali Flag" />
                                    }
                                    else
                                    {
                                        <img class="language" src="/assets/images/flags/us.svg" alt="English Flag" />
                                    }
                                </button>
                                @{
                                    var fullUrl = Context.Request.Path + Context.Request.QueryString;
                                }
                                <ul class="dropdown-menu" aria-labelledby="languageDropdown">
                                    <li>
                                        <a class="dropdown-item" href="/Users/Language/SetLanguage?culture=en&returnUrl=@fullUrl">
                                            <img class="header-icons language" src="/assets/images/flags/us.svg" alt="English Flag" /> @Localizer["English"]
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="/Users/Language/SetLanguage?culture=so&returnUrl=@fullUrl">
                                            <img class="header-icons language" src="/assets/images/flags/so.svg" alt="Somali Flag" /> @Localizer["Somali"]
                                        </a>
                                    </li>
                                </ul>
                            </div>

                            <!-- Shortcuts launcher -->
                            <div class="dropdown d-md-flex source-container">
                                <a class="nav-link icon shortcut-icn" data-bs-toggle="dropdown" data-tour="header.shortcuts" aria-label="Shortcuts">
                                    <i class="fe fe-grid header-icon"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow source-logo-menu pt-2 pb-2">
                                    <div class="drop-heading border-bottom d-f-ai-c">
                                        <h6 class="mb-0 fs-15 text-dark">SHORTCUTS</h6>
                                    </div>

                                    <div class="px-2 pb-4 pt-2">
                                        <!-- Row 1 -->
                                        <div class="row">
                                            <div class="col d-flex">
                                                <a asp-area="Admin" asp-controller="Employees" asp-action="Index" class="dropdown-menu-item text-muted source-logo-container">
                                                    <i class="fe fe-users"></i>
                                                    <span class="mt-1">@Localizer["Employees"]</span>
                                                </a>
                                            </div>
                                            <div class="col d-flex p-0">
                                                <a asp-area="Admin" asp-controller="Departments" asp-action="Index" class="dropdown-menu-item text-muted source-logo-container">
                                                    <i class="fa-solid fa-sitemap"></i>
                                                    <span class="mt-1">@Localizer["Departments"]</span>
                                                </a>
                                            </div>
                                            <div class="col d-flex">
                                                <a asp-area="Admin" asp-controller="Donors" asp-action="Index" class="dropdown-menu-item text-muted source-logo-container">
                                                    <i class="fe fe-credit-card"></i>
                                                    <span class="mt-1">@Localizer["Donors"]</span>
                                                </a>
                                            </div>
                                        </div>

                                        <!-- Row 2 -->
                                        <div class="row mb-2">
                                            <div class="col d-flex">
                                                <a asp-area="Admin" asp-controller="Categories" asp-action="Index" class="dropdown-menu-item source-logo-container">
                                                    <i class="fe fe-layers"></i>
                                                    <span class="mt-1">@Localizer["Categories"]</span>
                                                </a>
                                            </div>
                                            <div class="col d-flex p-0">
                                                <a asp-area="Users" asp-controller="Stores" asp-action="Index" class="dropdown-menu-item text-muted source-logo-container">
                                                    <i class="fe fe-box"></i>
                                                    <span class="mt-1">@Localizer["Stores"]</span>
                                                </a>
                                            </div>
                                            <div class="col d-flex">
                                                <a asp-area="Users" asp-controller="Transfers" asp-action="Index" class="dropdown-menu-item source-logo-container">
                                                    <i class="fe fe-repeat"></i>
                                                    <span class="mt-1">@Localizer["Transfers"]</span>
                                                </a>
                                            </div>
                                        </div>

                                        <!-- Row 3 -->
                                        <div class="row mb-2">
                                            <div class="col d-flex">
                                                <a asp-area="Users" asp-controller="Verifications" asp-action="Index" class="dropdown-menu-item source-logo-container">
                                                    <i class="fe fe-check-square"></i>
                                                    <span class="mt-1">@Localizer["Verifications"]</span>
                                                </a>
                                            </div>
                                            <div class="col d-flex p-0">
                                                <a asp-area="Users" asp-controller="Disposals" asp-action="Index" class="dropdown-menu-item source-logo-container">
                                                    <i class="fa-solid fa-recycle"></i>
                                                    <span class="mt-1">@Localizer["Disposals"]</span>
                                                </a>
                                            </div>
                                            <div class="col d-flex">
                                                <a asp-area="Users" asp-controller="Reporting" asp-action="Index" class="dropdown-menu-item source-logo-container">
                                                    <i class="fe fe-printer"></i>
                                                    <span class="mt-1">@Localizer["Reports"]</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Alerts -->
                            <div class="dropdown d-md-flex">
                                <a class="nav-link icon nav-link-bg" href="/Users/Alerts" data-tour="header.alerts" aria-label="Alerts">
                                    <i class="fe fe-alert-triangle header-icon"></i>
                                    <span class="pulse"></span>
                                </a>
                            </div>

                            <!-- Fullscreen -->
                            <div class="dropdown d-md-flex">
                                <a class="nav-link icon full-screen-link nav-link-bg" data-tour="header.fullscreen" aria-label="Fullscreen">
                                    <i class="fe fe-maximize header-icon"></i>
                                </a>
                            </div>

                            <!-- Notifications -->
                            <div class="dropdown d-md-flex notifications" data-tour="header.notifications">
                                <a class="nav-link icon" data-bs-toggle="dropdown" aria-label="Notifications">
                                    <i class="fe fe-bell header-icon"></i>
                                    <span id="notification-pulse" class="pulse"></span>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                    <div class="drop-heading border-bottom">
                                        <div class="d-flex">
                                            <h6 class="mt-1 mb-0 fs-15 text-dark">@Localizer["Notifications"]</h6>
                                            <div class="ms-auto">
                                                <span class="xm-title badge bg-secondary text-white fw-normal fs-11 badge-pill">
                                                    <a href="javascript:clearNotifications();" class="showall-text text-white">Clear</a>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="notifications-menu ps3 overflow-hidden ps" id="dvNotifications"></div>
                                    <div class="dropdown-divider m-0"></div>
                                    <div class="text-center p-3">
                                        <a asp-area="Users" asp-controller="Home" asp-action="AllNotifications" class="btn btn-primary">@Localizer["ViewAllNotifications"]</a>
                                    </div>
                                </div>
                            </div>

                            <!-- Profile -->
                            <div class="dropdown d-md-flex profile-1" data-tour="header.profile">
                                <a href="#" data-bs-toggle="dropdown" class="nav-link pe-2 leading-none d-flex animate" aria-label="Profile menu">
                                    <span id="profileImage">
                                        <img src="~/assets/images/faces/1.png" alt="profile-user" class="avatar profile-user brround cover-image">
                                    </span>
                                    <div class="text-center p-1 d-flex d-lg-none-max">
                                        <h6 class="mb-0" id="profile-heading">
                                            <i class="fe fe-chevron-down ms-1"></i>
                                        </h6>
                                    </div>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                    <a class="dropdown-item" asp-area="Users" asp-controller="Home" asp-action="Profile">
                                        <i class="fe fe-user header-icon me-1"></i> @Localizer["Profile"]
                                    </a>

                                    <a class="dropdown-item" asp-area="Users" asp-controller="Home" asp-action="Settings">
                                        <i class="fe fe-settings header-icon me-1"></i> @Localizer["Settings"]
                                    </a>

                                    <div class="dropdown-divider mb-0"></div>
                                    <form id="logoutForm" class="form-inline" asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })">
                                        <button id="logout" type="submit" class="dropdown-item">
                                            <i class="fe fe-log-out header-icon me-1"></i> @Localizer["Logout"]
                                        </button>
                                    </form>
                                </div>
                            </div>
                            <!-- /Profile -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function logOut() {
        $("#frmLogout").submit();
    }
</script>
<!-- /app-Header -->
