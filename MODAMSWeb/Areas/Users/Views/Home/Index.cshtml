@using Microsoft.AspNetCore.Mvc.Localization

@model MODAMS.Models.ViewModels.Dto.DashboardDTO
@inject IViewLocalizer Localizer

@{
    ViewData["TourPageKey"] = "Home/Index";
}

<link href="~/css/home-index.css" rel="stylesheet" />

<div class="page-header" data-tour="dashboard.header">
    <div>
        <h1 class="page-title">@Localizer["Dashboard"]</h1>
    </div>
    <br />

    <!-- News Ticker -->
    <div class="news-ticker-wrapper" aria-label="Newsfeed">
        <div class="news-ticker-track" id="newsTicker">
            @foreach (var newsfeed in Model.NewsFeed)
            {
                <a asp-area="Users" asp-controller="Home" asp-action="Newsfeed" class="news-item-link" aria-label="Open newsfeed">
                    <span class="news-item">
                        <svg class="news-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" role="img" aria-hidden="true">
                            <path d="M0 256L28.5 28c2-16 15.6-28 31.8-28H228.9c15 0 27.1 12.1 27.1 27.1
                                             c0 3.2-.6 6.5-1.7 9.5L208 160H347.3c20.2 0 36.7 16.4 36.7 36.7
                                             c0 7.4-2.2 14.6-6.4 20.7l-192.2 281c-5.9 8.6-15.6 13.7-25.9 13.7h-2.9
                                             c-15.7 0-28.5-12.8-28.5-28.5c0-2.3 .3-4.6 .9-6.9L176 288H32
                                             c-17.7 0-32-14.3-32-32z" />
                        </svg>
                        <span class="news-text">@newsfeed.Description</span>
                    </span>
                </a>
            }
        </div>
    </div>

    <div class="ms-auto pageheader-btn">
        <ol class="breadcrumb">
            <li class="breadcrumb-item active"><a href="javascript:void(0);">@Localizer["Dashboard"]</a></li>
        </ol>
    </div>
</div>

<div class="row" data-tour="dashboard.tiles">
    <!-- Stores -->
    <div class="col-md-3">
        <a asp-area="Users" asp-controller="Stores" asp-action="Index">
            <div class="card divShadow--xs">
                <div class="card-status bg-primary br-tr-7 br-tl-7"></div>
                <div class="card-body pnlHeight">
                    <div class="row">
                        <div class="col">
                            <h3 class="mb-2 fw-semibold text-muted">@Localizer["Stores"]</h3>
                            <p class="text-muted fs-13 mb-0">@Localizer["Stores"]</p>
                        </div>
                        <div class="col col-auto top-icn dash">
                            <div class="counter-icon bg-primary dash ms-auto box-shadow-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-archive" viewBox="0 0 16 16">
                                    <path d="M0 2a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 12.5V5a1 1 0 0 1-1-1V2zm2 3v7.5A1.5 1.5 0 0 0 3.5 14h9a1.5 1.5 0 0 0 1.5-1.5V5H2zm13-3H1v2h14V2zM5 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z" />
                                </svg>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <small class="text-muted">@Localizer["StoreDescription"]</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>

    <!-- Transfers -->
    <div class="col-md-3">
        <a asp-area="Users" asp-controller="Transfers" asp-action="Index" class="text-secondary">
            <div class="card divShadow--xs">
                <div class="card-status bg-secondary br-tr-7 br-tl-7"></div>
                <div class="card-body pnlHeight">
                    <div class="row">
                        <div class="col">
                            <h3 class="mb-2 fw-semibold text-muted">@Localizer["Transfers"]</h3>
                            <p class="text-muted fs-13 mb-0 text-secondary">@Localizer["AssetTransfers"]</p>
                        </div>
                        <div class="col col-auto top-icn dash">
                            <div class="counter-icon bg-secondary dash ms-auto box-shadow-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-arrow-left-right" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z" />
                                </svg>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <small class="text-muted">@Localizer["TransferDescription"]</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>

    <!-- Disposals -->
    <div class="col-md-3">
        <a asp-area="Users" asp-controller="Disposals" asp-action="Index" class="text-info">
            <div class="card divShadow--xs">
                <div class="card-status bg-info br-tr-7 br-tl-7"></div>
                <div class="card-body pnlHeight">
                    <div class="row">
                        <div class="col">
                            <h3 class="mb-2 fw-semibold text-muted">@Localizer["Disposal"]</h3>
                            <p class="text-muted fs-13 mb-0">@Localizer["AssetDisposal"]</p>
                        </div>
                        <div class="col col-auto top-icn dash">
                            <div class="counter-icon bg-info dash ms-auto box-shadow-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-basket3" viewBox="0 0 25 25">
                                    <g>
                                        <path fill="none" d="M0 0H24V24H0z"></path>
                                        <path d="M19.562 12.098l1.531 2.652c.967 1.674.393 3.815-1.28 4.781-.533.307-1.136.469-1.75.469H16v2l-5-3.5 5-3.5v2h2.062c.088 0 .174-.023.25-.067.213-.123.301-.378.221-.601l-.038-.082-1.531-2.652 2.598-1.5zM7.737 9.384l.53 6.08-1.73-1-1.032 1.786c-.044.076-.067.162-.067.25 0 .245.177.45.41.492l.09.008H9v3H5.938c-1.933 0-3.5-1.567-3.5-3.5 0-.614.162-1.218.469-1.75l1.031-1.786-1.732-1 5.53-2.58zm6.013-6.415c.532.307.974.749 1.281 1.281l1.03 1.786 1.733-1-.53 6.08-5.532-2.58 1.732-1-1.031-1.786c-.044-.076-.107-.14-.183-.183-.213-.123-.478-.072-.631.11l-.052.073-1.53 2.652-2.599-1.5 1.53-2.652c.967-1.674 3.108-2.248 4.782-1.281z"></path>
                                    </g>
                                </svg>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <small class="text-muted">@Localizer["DisposalDescription"]</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>

    <!-- Reports -->
    <div class="col-md-3">
        <a asp-area="Users" asp-controller="Reporting" asp-action="Index" class="text-warning">
            <div class="card divShadow--xs">
                <div class="card-status bg-warning br-tr-7 br-tl-7"></div>
                <div class="card-body pnlHeight">
                    <div class="row">
                        <div class="col">
                            <h3 class="mb-2 fw-semibold text-muted">@Localizer["Reports"]</h3>
                            <p class="text-muted fs-13 mb-0">@Localizer["Reporting"]</p>
                        </div>
                        <div class="col col-auto top-icn dash">
                            <div class="counter-icon bg-warning dash ms-auto box-shadow-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">
                                    <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z" />
                                    <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z" />
                                </svg>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <small class="text-muted">@Localizer["ReportingDescription"]</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- ✅ Table & Chart -->
<div class="card">
    <div class="card-body">
        <div class="row">
            <div class="row">
                <!-- ✅ Tour: Table -->
                <div class="col-md-6 mb-3" data-tour="dashboard.table">
                    <div class="table-responsive">
                        <table id="tblCategories" class="table text-nowrap mb-0 table-bordered border-top border-bottom divShadow--xs">
                            <thead class="bg-primary-gradient ms-auto divShadow--xs">
                                <tr>
                                    <th class="text-white">@Localizer["Category"]</th>
                                    <th class="text-white">@Localizer["Count"]</th>
                                    <th class="text-white">@Localizer["Cost"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.CategoryAssets.Count > 0)
                                {
                                    foreach (var sca in Model.CategoryAssets)
                                    {
                                        <tr class="clickable-row"
                                            data-href="@Url.Action("AssetList", "Assets", new { id = sca.Id })">
                                            <td class="text-muted fs-15 fw-semibold">@sca.CategoryName</td>
                                            <td class="text-muted fs-15 fw-semibold">@sca.TotalAssets</td>
                                            <td class="text-muted fs-15 fw-semibold text-end">@sca.TotalCost.ToString("N2")</td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr><td colspan="3">No Assets available!</td></tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ✅ Tour: Chart (original location) -->
                <div class="col-md-6 mt-5 container" data-tour="dashboard.chart">
                    <div id="chart"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ✅ Tour: Summary -->
    <div class="card-footer" data-tour="dashboard.summary">
        <div class="row">
            <div class="col-md-3">
                <div class="card ">
                    <div class="card-body pnlHeightFooter">
                        <div class="row">
                            <div class="col-8">
                                <h5 class="text-muted">@Localizer["TotalAssets"]</h5>
                                <p class="text-muted text-bold">@(Model.TotalAssets().ToString("N0") ?? "0")</p>
                            </div>
                            <div class="col-4">
                                <div class="hpx-50 wpx-50 bg-primary br-5 d-flex align-items-center justify-content-center ms-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="text-white w-icn" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path d="M17,4h-1.1846313C15.4013672,2.8383179,14.3035889,2.0014648,13,2h-2C9.6964111,2.0014648,8.5986328,2.8383179,8.1846313,4H7C5.3438721,4.0018311,4.0018311,5.3438721,4,7v12c0.0018311,1.6561279,1.3438721,2.9981689,3,3h10c1.6561279-0.0018311,2.9981689-1.3438721,3-3V7C19.9981689,5.3438721,18.6561279,4.0018311,17,4z M9,5c0.0014038-1.1040039,0.8959961-1.9985962,2-2h2c1.1040039,0.0014038,1.9985962,0.8959961,2,2v2H9V5z M19,19c-0.0014038,1.1040039-0.8959961,1.9985962-2,2H7c-1.1040039-0.0014038-1.9985962-0.8959961-2-2V7c0.0014038-1.1040039,0.8959961-1.9985962,2-2h1v2.5006104C8.0001831,7.7765503,8.223999,8.0001831,8.5,8h7.0006104C15.7765503,7.9998169,16.0001831,7.776001,16,7.5V5h1c1.1040039,0.0014038,1.9985962,0.8959961,2,2V19z"></path></svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card ">
                    <div class="card-body pnlHeightFooter">
                        <div class="row">
                            <div class="col-8">
                                <h5 class="text-muted">@Localizer["TotalCost"]</h5>
                                <p class="text-muted text-bold">@(Model.TotalCost().ToString("n2") ?? "0")</p>
                            </div>
                            <div class="col-4">
                                <div class="hpx-50 wpx-50 bg-secondary br-5 d-flex align-items-center justify-content-center ms-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="text-white w-icn" enable-background="new 0 0 24 24" viewBox="0 0 24 24">
                                        <path d="M17,4h-1.1846313C15.4013672,2.8383179,14.3035889,2.0014648,13,2h-2C9.6964111,2.0014648,8.5986328,2.8383179,8.1846313,4H7C5.3438721,4.0018311,4.0018311,5.3438721,4,7v12c0.0018311,1.6561279,1.3438721,2.9981689,3,3h10c1.6561279-0.0018311,2.9981689-1.3438721,3-3V7C19.9981689,5.3438721,18.6561279,4.0018311,17,4z M9,5c0.0014038-1.1040039,0.8959961-1.9985962,2-2h2c1.1040039,0.0014038,1.9985962,0.8959961,2,2v2H9V5z M19,19c-0.0014038,1.1040039-0.8959961,1.9985962-2,2H7c-1.1040039-0.0014038-1.9985962-0.8959961-2-2V7c0.0014038-1.1040039,0.8959961-1.9985962,2-2h1v2.5006104C8.0001831,7.7765503,8.223999,8.0001831,8.5,8h7.0006104C15.7765503,7.9998169,16.0001831,7.776001,16,7.5V5h1c1.1040039,0.0014038,1.9985962,0.8959961,2,2V19z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card ">
                    <div class="card-body pnlHeightFooter">
                        <div class="row">
                            <div class="col-8">
                                <h5 class="text-muted">@Localizer["CurrentValue"]</h5>
                                <p class="text-muted text-bold">@(Model.CurrentValue.ToString("n2") ?? "0")</p>
                            </div>
                            <div class="col-4">
                                <div class="hpx-50 wpx-50 bg-info br-5 d-flex align-items-center justify-content-center ms-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="text-white w-icn" enable-background="new 0 0 24 24" viewBox="0 0 24 24">
                                        <path d="M17,4h-1.1846313C15.4013672,2.8383179,14.3035889,2.0014648,13,2h-2C9.6964111,2.0014648,8.5986328,2.8383179,8.1846313,4H7C5.3438721,4.0018311,4.0018311,5.3438721,4,7v12c0.0018311,1.6561279,1.3438721,2.9981689,3,3h10c1.6561279-0.0018311,2.9981689-1.3438721,3-3V7C19.9981689,5.3438721,18.6561279,4.0018311,17,4z M9,5c0.0014038-1.1040039,0.8959961-1.9985962,2-2h2c1.1040039,0.0014038,1.9985962,0.8959961,2,2v2H9V5z M19,19c-0.0014038,1.1040039-0.8959961,1.9985962-2,2H7c-1.1040039-0.0014038-1.9985962-0.8959961-2-2V7c0.0014038-1.1040039,0.8959961-1.9985962,2-2h1v2.5006104C8.0001831,7.7765503,8.223999,8.0001831,8.5,8h7.0006104C15.7765503,7.9998169,16.0001831,7.776001,16,7.5V5h1c1.1040039,0.0014038,1.9985962,0.8959961,2,2V19z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card ">
                    <div class="card-body pnlHeightFooter">
                        <div class="row">
                            <div class="col-8">
                                <h5 class="text-muted">@Localizer["TotalStores"]</h5>
                                <p class="text-muted text-bold">@Model.StoreCount</p>
                            </div>
                            <div class="col-4">
                                <div class="hpx-50 wpx-50 bg-warning br-5 d-flex align-items-center justify-content-center ms-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="text-white w-icn" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path d="M17,4h-1.1846313C15.4013672,2.8383179,14.3035889,2.0014648,13,2h-2C9.6964111,2.0014648,8.5986328,2.8383179,8.1846313,4H7C5.3438721,4.0018311,4.0018311,5.3438721,4,7v12c0.0018311,1.6561279,1.3438721,2.9981689,3,3h10c1.6561279-0.0018311,2.9981689-1.3438721,3-3V7C19.9981689,5.3438721,18.6561279,4.0018311,17,4z M9,5c0.0014038-1.1040039,0.8959961-1.9985962,2-2h2c1.1040039,0.0014038,1.9985962,0.8959961,2,2v2H9V5z M19,19c-0.0014038,1.1040039-0.8959961,2-2,2H7c-1.1040039,0-2-0.8959961-2-2V7c0.0014038-1.1040039,0.8959961-2,2-2h1v2.5006104C8.0001831,7.7765503,8.223999,8,8.5,8h7.0006104C15.7765503,8,16,7.776001,16,7.5V5h1c1.1040039,0,2,0.8959961,2,2V19z"></path></svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- C3 (needs D3 first). You can move this link to your layout if desired. -->
<link rel="stylesheet" href="~/assets/plugins/c3-0.7.20/c3.min.css" />
@section scripts {
    
    <script src="~/assets/plugins/c3-0.7.20/d3-5.8.2.min.js"></script>
    <script src="~/assets/plugins/c3-0.7.20/c3.min.js"></script>

    <script>
        window.dashData = {
          categoryAssets: @Html.Raw(Json.Serialize(Model.CategoryAssets))
        };
    </script>

    <script src="~/js/pages/home-index.js"></script>
}


